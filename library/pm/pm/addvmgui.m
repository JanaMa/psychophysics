function [] = addvmgui(varargin)

if nargin > 0
  cnf.wd=get(findobj(gcbf,'tag','editwd'),'string');
  h=findobj(gcbf,'tag','popprio');
  cnf.prio=get(h,'userdata'); cnf.prio=cnf.prio{get(h,'value')};
  cnf.try=get(findobj(gcbf,'tag','edittry'),'string');
  cnf.catch=get(findobj(gcbf,'tag','editcatch'),'string');
  h=findobj(gcbf,'tag','poprunmode');
  cnf.runmode=get(h,'userdata'); cnf.runmode=cnf.runmode{get(h,'value')};
  vm(cnf);
  pmspawner('refresh','vm','vmattr'); 
  closereq;
  return;
end 

h0 = figure('Units','points', ...
	'Color',[0.8 0.8 0.8], ...
	'FileName','addvmgui.m', ...
	'MenuBar','none', ...
	'Name','Add Virtual Machine', ...
	'NumberTitle','off', ...
	'PaperPosition',[18 180 576 432], ...
	'PaperUnits','points', ...
	'Position',[176 72.8 200 264.8], ...
	'Tag','Fig1', ...
	'ToolBar','none');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'ListboxTop',0, ...
	'Position',[8 36 188 220], ...
	'Style','frame', ...
	'Tag','Frame1');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.701960784313725 0.701960784313725 0.701960784313725], ...
	'Callback','closereq', ...
	'ListboxTop',0, ...
	'Position',[12 8 64 20], ...
	'String','Cancel', ...
	'Tag','butcancel');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'Callback','addvmgui(''addvm'')',...
	'BackgroundColor',[0.701960784313725 0.701960784313725 0.701960784313725], ...
	'ListboxTop',0, ...
	'Position',[124 8 64 20], ...
	'String','Create', ...
	'Tag','butadd');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[1 1 1], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[12 84 180 20], ...
	'Style','edit', ...
	'Tag','editcatch');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[12 104 176 16], ...
	'String','Catch expression', ...
	'Style','text', ...
	'Tag','StaticText1');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[1 1 1], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[12 128 180 20], ...
	'Style','edit', ...
	'Tag','edittry');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[12 148 176 16], ...
	'String','Try expression', ...
	'Style','text', ...
	'Tag','StaticText1');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.701960784313725 0.701960784313725 0.701960784313725], ...
	'ListboxTop',0, ...
	'Max',2, ...
	'Min',1, ...
	'Position',[12 44 176 20], ...
	'String',{'background (bg)' 'with console (fg)'}, ...
	'Userdata',{'bg' 'fg'}, ...
	'Style','popupmenu', ...
	'Tag','poprunmode', ...
	'Value',2);
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[12 64 52 16], ...
	'String','Runmode', ...
	'Style','text', ...
	'Tag','StaticText1');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.701960784313725 0.701960784313725 0.701960784313725], ...
	'ListboxTop',0, ...
	'Max',3, ...
	'Min',1, ...
	'Position',[12 172 176 20], ...
	'String',{'same as current' 'normal' 'low'}, ...
	'Style','popupmenu', ...
	'Userdata',{'same' 'normal' 'low'}, ...
	'Tag','popprio', ...
	'Value',2);
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[12 192 52 16], ...
	'String','Priority', ...
	'Style','text', ...
	'Tag','StaticText1');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[0.8 0.8 0.8], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[12 236 176 16], ...
	'String','Work directory', ...
	'Style','text', ...
	'Tag','StaticText1');
h1 = uicontrol('Parent',h0, ...
	'Units','points', ...
	'BackgroundColor',[1 1 1], ...
	'HorizontalAlignment','left', ...
	'ListboxTop',0, ...
	'Position',[12 216 180 20], ...
	'Style','edit', ...
	'String',pwd, ...
	'Tag','editwd');

