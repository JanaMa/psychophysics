function e = GloLoAdjustment(varargin)
    e = Experiment...
        ( 'params', struct...
            ( 'skipFrames', 1  ...
            , 'requireCalibration', 1 ...
            , 'priority', 9 ...
            , 'hideCursor', 0 ...
            , 'doTrackerSetup', 0 ...
            , 'input', struct ...
                ( 'keyboard', KeyboardInput() ...
                , 'knob', PowermateInput() ...
                ) ...
            )...
        , varargin{:} ...
        );
    
    e.trials = Randomizer('fullFactorial', 1, 'reps', 2, 'blockSize', 98);
    
    e.trials.base = GloLoAdjustmentTrial...
        ( 'barOnset', 0 ...                         %randomized below
        , 'barBackgroundColor', [0.5 0.5 0.5] ...
        , 'barFlashColor', [1 1 1] ...
        , 'barFlashDuration', 1/30 ...
        , 'loopDuration', 1.2 ...
        , 'barLength', 2 ...
        , 'barWidth', 0.15 ...
        , 'barPhase', 0 ...                         %randomized below
        , 'barPhaseStep', 2*pi/1024 ...
        , 'barRadius', 8 ...
        , 'fixationPointSize', 0.1 ...
        , 'motion', CircularMotionProcess ...
            ( 'angle', 90 ...
            , 'color', [0.5; 0.5; 0.5] ...
            , 'dt', 0.2 ...
            , 'n', 5 ...
            , 'phase', 0 ...                        %randomized below
            , 'radius', 5 ...
            , 't', 0.2 ...
            , 'dphase', 1/5 ...                     %randomized below
            )...
        , 'patch', CauchyPatch...
            ( 'size', [0.375 1 0.075]...
            , 'velocity', 5 ...                     %randomized below
            , 'order', 4 ...
            ) ...
        );
    
    %tell the randomizer how to randomize the trial each time.
    
    %local and global motion randomize
    e.trials.add('patch.velocity', e.trials.base.patch.velocity * [-1 0 1]);
    e.trials.add('motion.dphase', [-1 1] ./ e.trials.base.motion.radius);
    
    %The range of temporal offsets
    
    %from the onset of the first flash to the onset of the fourth flash is
    %49 timepoints at 120 fps
    e.trials.add('barOnset', e.trials.base.motion.t + e.trials.base.motion.dt * linspace(1,3,49));
    
    %The bar origin is random around the circle and orientation follows
    e.trials.add({'motion.phase', 'motion.angle'}, @(x)num2cell(rand()*2*pi * [1 180/pi] + [0 90]));

    %and for each trial pick an appropriate bar phase based on these
    %add some noise to the bar phase to avoid hysteresis
    e.trials.add('barPhase', @(b) (b.motion.phase + (b.barOnset-b.motion.t(1))*b.motion.dphase ./ b.motion.dt + round( randc(1)*b.motion.dphase / b.barPhaseStep ) * b.barPhaseStep ) );
    
    %the message to show between blocks
    e.trials.blockTrial = MessageTrial('message', @()sprintf('Press knob to continue. %d blocks remain', e.trials.blocksLeft()));